<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - AlojaT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --orange-color: #ff8c00;
            --light-orange: #fff3e6;
            --dark-orange: #e67e00;
        }

        body {
            background-color: var(--light-orange);
          margin-top: -40px;
          margin-bottom: 10px;
        }

        .card {
            border-radius: 15px;
            border: none;
        }

        .card-header {
            background-color: var(--orange-color);
            color: white;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            padding: 20px;
        }

        .form-label {
            color: var(--dark-orange);
            font-weight: 500;
        }

        .form-control:focus {
            border-color: var(--orange-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 140, 0, 0.25);
        }

        .btn-primary {
            background-color: var(--orange-color);
            border-color: var(--orange-color);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--dark-orange);
            border-color: var(--dark-orange);
            transform: translateY(-2px);
        }

        .form-check-input:checked {
            background-color: var(--orange-color);
            border-color: var(--orange-color);
        }

        #togglePassword {
            cursor: pointer;
            color: var(--orange-color);
            transition: color 0.3s ease;
        }

        #togglePassword:hover {
            color: var(--dark-orange);
        }
    </style>
</head>
<body class="bg-light">
  
<div class="container">
    <div class="row justify-content-center mt-5">
        <div class="col-md-7">
            <div class="card shadow">
                <div class="card-header text-center">
                    <h3 class="card-title mb-0">Registro - AlojaT</h3>
                </div>
                <div class="card-body">
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category=='danger' else 'success' }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}


                    <form method="POST" id="registrationForm" class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="nombre" class="form-label">Nombre</label>
                                <input type="text" name="nombre" id="nombre" class="form-control" required>
                                <div class="invalid-feedback">Por favor, ingresa tu nombre.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="apellido" class="form-label">Apellido</label>
                                <input type="text" name="apellido" id="apellido" class="form-control" required>
                                <div class="invalid-feedback">Por favor, ingresa tu apellido.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="correo" class="form-label">Correo</label>
                            <input type="email" name="correo" id="correo" class="form-control" required>
                            <div class="invalid-feedback">Ingresa un correo v√°lido, por ejemplo: usuario@ejemplo.com.</div>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Contrase√±a</label>
                            <div class="input-group">
                                <input type="password" name="contrase√±a" id="password" class="form-control" required minlength="8">
                                <span class="input-group-text" id="togglePassword">
                                    üëÅÔ∏è
                                </span>
                                <div class="invalid-feedback">La contrase√±a debe tener al menos 8 caracteres.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="fecha_nacimiento" class="form-label">Fecha de nacimiento</label>
                            <input type="date" name="fecha_nacimiento" id="fecha_nacimiento" class="form-control" required>
                            <div class="invalid-feedback" id="age-validation-message">Debes ser mayor de 18 a√±os para registrarte.</div>
                        </div>

                        <div class="mb-3">
                            <label for="direccion_postal" class="form-label">Direcci√≥n personal (Opcional)</label>
                            <input type="text" name="direccion_postal" id="direccion_postal" class="form-control">
                        </div>

                        <div class="mb-3">
                            <label for="documento_identidad" class="form-label">Documentos de identidad (m√≠nimo 2, separados por coma)</label>
                            <input type="text" name="documento_identidad" id="documento_identidad" class="form-control" placeholder="id1_f.jpg,id1_r.jpg" required>
                            <div class="invalid-feedback">Por favor, sube al menos 2 documentos (ej. "id1_f.jpg, id1_r.jpg").</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Rol (selecciona al menos uno)</label>
                            <div class="form-check">
                                <input class="form-check-input rol-checkbox" type="checkbox" name="rol" value="anfitrion" id="rol_anfitrion">
                                <label class="form-check-label" for="rol_anfitrion">Anfitri√≥n</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input rol-checkbox" type="checkbox" name="rol" value="huesped" id="rol_huesped">
                                <label class="form-check-label" for="rol_huesped">Hu√©sped</label>
                            </div>
                            <div class="invalid-feedback d-block" id="rol-validation-message" style="display: none;">Debes seleccionar al menos un rol.</div>
                        </div>

                        <div class="mb-3" id="clabe-container" style="display:none;">
                            <label for="clabe" class="form-label">CLABE bancaria (solo si eres anfitri√≥n)</label>
                            <input type="text" name="clabe_bancaria" id="clabe" class="form-control" placeholder="18 d√≠gitos" pattern="\d{18}">
                            <div class="invalid-feedback">La CLABE debe contener exactamente 18 d√≠gitos.</div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Registrarse</button>
                    </form>

                    <p class="text-center mt-3">
                        ¬øYa tienes cuenta? <a href="{{ url_for('login') }}" class="text-decoration-none" style="color: var(--orange-color);">Inicia sesi√≥n</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const anfitrionCheckbox = document.getElementById('rol_anfitrion');
    const clabeContainer = document.getElementById('clabe-container');
    const clabeInput = document.getElementById('clabe');
    const passwordInput = document.getElementById('password');
    const togglePassword = document.getElementById('togglePassword');
    const registrationForm = document.getElementById('registrationForm');
    const ageInput = document.getElementById('fecha_nacimiento');
    const rolCheckboxes = document.querySelectorAll('.rol-checkbox');
    const rolValidationMessage = document.getElementById('rol-validation-message');

    // Muestra/oculta el campo de la CLABE si se selecciona "Anfitri√≥n"
    function toggleClabe() {
        if (anfitrionCheckbox.checked) {
            clabeContainer.style.display = 'block';
            clabeInput.required = true;
        } else {
            clabeContainer.style.display = 'none';
            clabeInput.required = false;
        }
    }
    anfitrionCheckbox.addEventListener('change', toggleClabe);
    toggleClabe(); // Llama al inicio para establecer el estado

    // Muestra/oculta la contrase√±a
    togglePassword.addEventListener('click', function (e) {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.innerHTML = type === 'password' ? 'üëÅÔ∏è' : 'üîí';
    });

    // Validaciones del formulario
    registrationForm.addEventListener('submit', function (event) {
        let formIsValid = true;

        // Validaci√≥n de edad
        const birthDate = new Date(ageInput.value);
        const today = new Date();
        const age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        if (age < 18) {
            ageInput.setCustomValidity("Invalid");
            document.getElementById('age-validation-message').style.display = 'block';
            formIsValid = false;
        } else {
            ageInput.setCustomValidity("");
            document.getElementById('age-validation-message').style.display = 'none';
        }

        // Validaci√≥n de al menos un rol seleccionado
        const isAnyRolChecked = Array.from(rolCheckboxes).some(cb => cb.checked);
        if (!isAnyRolChecked) {
            rolValidationMessage.style.display = 'block';
            formIsValid = false;
        } else {
            rolValidationMessage.style.display = 'none';
        }

        if (!formIsValid || !registrationForm.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }

        registrationForm.classList.add('was-validated');
    }, false);
</script>

</body>
</html>